# Managed by Ansible
# DO NOT EDIT, changes will be overwritten.

local {{ openvpn_server.local | default('0.0.0.0') }}
port {{ openvpn_server.port | default('1194') }}
proto {{ openvpn_server.proto | default('udp') }}
dev {{ openvpn_server.dev | default('tun') }}

ca {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/ca.crt
cert {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/server.crt
key {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/server.key
dh {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/dh.pem

server {{ openvpn_server.server }}

{% if openvpn_server.crl is defined -%}
crl-verify {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/crl.pem
{% endif %}

{% if openvpn_server.ta_key is defined -%}
tls-auth {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/ta.key 0
{% endif %}

{% if openvpn_server.persist_ifconfig_pool | default(False) -%}
ifconfig-pool-persist {{ openvpn_common_config_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/ifconfig-pool
{% endif %}

{% if openvpn_server.cipher is defined -%}
cipher {{ openvpn_server.cipher }}
{% endif %}

user {{ openvpn_server.user | default('nobody') }}
group {{ openvpn_server.group | default('nogroup') }}

{# TODO: % if openvpn_server.use_status_file | default(True) -%#}
status {{ openvpn_common_status_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}.status
{#% endif %#}

{# TODO: % if openvpn_server.use_log_file | default(True) -%#}
log-append  {{ openvpn_common_log_dir }}/{{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}.log
{#% endif %#}

verb {{ openvpn_server.verb | default('1') }}

{% if openvpn_server.max_clients is defined -%}
max-clients {{ openvpn_server.max_clients }}
{% endif %}

keepalive {{ openvpn_server.keepalive | default('10 120') }}

tls-server

{% if openvpn_server.comp_lzo | default(False) -%}
comp-lzo
{% endif %}

persist-key
persist-tun

{% if openvpn_server.float | default(False) -%}
float
{% endif %}

script-security {{ openvpn_server.script_security | default(1) }}

{% if openvpn_server.client_configs | default(False) %}
client-config-dir {{ openvpn_server.server_name }}@{{ openvpn_server.vpn_name }}/ccd
{% endif %}

{% for route in openvpn_server.routes | default([]) -%}
route {{ route }}
{% endfor %}

{% if openvpn_server.client_to_client | default(False) -%}
client-to-client
{% endif %}

{% for option in openvpn_server.push | default([]) -%}
push "{{ option }}"
{% endfor %}

# custom options set from ansible
{% for option in openvpn_server.options | default([]) %}
{{ option }}
{% endfor %}
